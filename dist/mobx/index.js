import{b as _,c as x}from"../storage/index.js";import{get as v,observe as b,set as m}from"mobx";var d=(e)=>{if(typeof e==="string")return{local_key:e,proxy_key:e};else{let s=Object.keys(e)[0],n=e[s];if(typeof n==="function")return{local_key:s,proxy_key:s,getHandler:n};return{local_key:s,proxy_key:n}}},w=(e,o,s)=>{let n=s?.useSession?x:_;return e.map((p)=>{let r=d(p),a=n.getItem(r.local_key);if(a!==void 0)if(r.getHandler)m(o,r.proxy_key,r.getHandler(a));else m(o,r.proxy_key,a);else n.setItem(r.local_key,v(o,r.proxy_key))}),b(o,({name:p,newValue:r})=>{e.map((a)=>{if(p===d(a).proxy_key)n.setItem(d(a).local_key,r)})})};import{deepEqual as k}from"fast-equals";import{get as h}from"lodash-es";import{observe as I,reaction as O,toJS as g}from"mobx";var V=(e)=>{let o=e.watch,s={},n={},p=[];Object.keys(o).map((t)=>{if(t.indexOf("|")!==-1){let l=t.split("|");p.push(...l.map((y)=>({key:y,raw:t})))}if(t.indexOf(".")!==-1)s[t]=o[t];else n[t]=o[t]});let r=Object.keys(s).map((t)=>{return O(()=>h(e,t),(l,y)=>{let f=g(l),c=g(y);if(!k(f,c))s[t](f,c)})}),a=I(e,(t)=>{let{name:l,newValue:y,oldValue:f}=t,c=p.find((i)=>{if(i.key===l)return i});if(c){let i=c.raw.split("|");if(i.includes(l))o[c.raw](i.map((u)=>h(e,u)))}if(o[l]){let i=g(y),u=g(f);if(!k(i,u))o[l](i,u)}});return[...r,a]};export{V as useInstanceWatch,w as setStorageWhenChange};export{V as a};
