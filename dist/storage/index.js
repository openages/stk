function W(n,f,i){const c={ctx:this,fn:i};let o=$.get(n);if(!o)$.set(n,o=new Map);const x=o.get(f);if(x)x.push(c);else o.set(f,[c])}function A(n,f,i){const c=this,o=(x,b)=>{N(n,f,o),i.call(c,x,b)};o.fn=i,W(n,f,o)}function N(n,f,i){if(f===void 0){$.set(n,new Map);return}let c=$.get(n);if(c){const o=c.get(f);if(o&&o.length>0){let x=[];if(i)x=o.filter((b)=>!(b.fn===i||b.fn?.fn===i));c.set(f,x)}}}function E(n,f,...i){const c=$.get(n);if(c){const o=c.get(f);if(o){const[x,b]=i;o.forEach((d)=>d.fn.call(d.ctx,x,b))}}}var $=new WeakMap;function J(n){try{return JSON.parse(n)}catch(f){return n}}function Y(n,f){return!n.hasOwnProperty(f)&&f in n}function s(n){const f=eval;return function(){return f(n)}()}var O=Array.isArray;var G=(n)=>Q(n)==="[object Date]";var H=(n)=>typeof n==="string",m=(n)=>n!==null&&typeof n==="object",U=(n)=>typeof n==="string"&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Q=(n)=>Object.prototype.toString.call(n),X=(n)=>{return Q(n).slice(8,-1)},B=(n,f)=>!Object.is(n,f),v=Object.prototype.hasOwnProperty,D=(n,f)=>v.call(n,f);function t(n){S=`${n}:`}function Z(){F=!1}function _(){F=!0}function M(n,f){return function(){delete n[f]}}var S="",j=new WeakMap,w={storage:{},key:"",proxy:{}},F=!0;function z(n,f,...i){let c=`${w.key}.${f}`;if(O(n)&&U(f))c=`${w.key}[${f}]`;E(w.storage,c,...i)}function y(){const n={};return["push","pop","shift","unshift","splice"].forEach((f)=>{n[f]=function(...i){R=!0;const c=this.length,o=j.get(this)[f].apply(this,i);if(this.length>c)z(this,"length",this.length,c);return R=!1,o}}),n}function e(n,f,i){if(O(n)&&D(P,f))return Reflect.get(P,f,i);return Reflect.get(n,f,i)}function C(n){Z();let f=w.proxy.getExpires(w.key);if(w.proxy[w.key]=n,f)w.proxy.setExpires(w.key,f);_()}function a(n,f,i,c){let o;if(O(n)&&!R)o=n.length;const x=n[f],b=O(n)&&U(f)?Number(f)<n.length:D(n,f),d=Reflect.set(n,f,i,c);if(d&&B(i,x)){if(b)z(n,f,i,x);else z(n,f,i,void 0);if(O(n)&&o!==void 0&&Number(f)>=o)z(n,"length",n.length,o);C(n)}return d}function nn(n,f){const i=D(n,f),c=n[f],o=Reflect.deleteProperty(n,f);if(o&&i)z(n,f,void 0,c),C(n);return o}function V(n){const f=new Proxy(n,{get:e,set:a,deleteProperty:nn});return j.set(f,n),f}var R=!1,P=y();function u(n,f){if(!n)return;let i=n;try{i=J(n)}catch(o){}if(!m(i))return i;if(i.expires&&new Date(+i.expires).getTime()<=Date.now()){f?.();return}const c=I[i.type];if(!c)return i.value;return c.read(i.value)}function T(n,f){const i=X(n),c=I[i];if(!c)throw new Error(`can't set "${i}" property.`);let o={type:i,value:c.write(n)};if(f)o.expires=f;return JSON.stringify(o)}var I={String:{read:(n)=>n,write:(n)=>n},Number:{read:(n)=>Number.parseFloat(n),write:(n)=>String(n)},BigInt:{read:(n)=>BigInt(n),write:(n)=>String(n)},Boolean:{read:(n)=>n==="true",write:(n)=>String(n)},Null:{read:()=>null,write:(n)=>String(n)},Undefined:{read:()=>{return},write:(n)=>String(n)},Object:{read:(n)=>V(n),write:(n)=>n},Array:{read:(n)=>V(n),write:(n)=>n},Set:{read:(n)=>new Set(n),write:(n)=>Array.from(n)},Map:{read:(n)=>new Map(n),write:(n)=>Array.from(n)},Date:{read:(n)=>new Date(n),write:(n)=>String(n)},RegExp:{read:(n)=>s(n),write:(n)=>String(n)},Function:{read:(n)=>s(`(function() { return ${n} })()`),write:(n)=>String(n)}};function L(n,f,i,c){let o;if(G(i))o=i.getTime();else if(H(i))o=+i.padEnd(13,"0");else o=i;if(o<=Date.now()){delete c[f];return}let x=c[f];if(!x)return;return x=j.get(x)||x,n[`${S}${f}`]=T(x,""+o),new Date(o)}function p(n,f){const i=`${S}${f}`;if(!n[i])return;let c=J(n[i]);if(!m(c)||!c.expires||+c.expires<=Date.now())return;return new Date(+c.expires)}function K(n,f,i){let c=i[f];if(!c)return;c=j.get(c)||c,n[`${S}${f}`]=T(c);return}function fn(n,f){const i={};["clear","key"].forEach((x)=>{i[x]=n[x].bind(n)});const c={getItem:l,setItem:r,setExpires:L,removeExpires:K};Object.keys(c).forEach((x)=>{i[x]=function(...b){return c[x](n,...b,f)}});const o={removeItem:k,getExpires:p,off:N,on:W,once:A};return Object.keys(o).forEach((x)=>{i[x]=function(...b){return o[x](n,...b)}}),i}function l(n,f,i){if(F)w.storage=n,w.key=f,w.proxy=i;let c=h.get(n);if(!c)c=fn(n,i),h.set(n,c);if(D(c,f))return Reflect.get(c,f,i);if(!g(n,f))return;const o=`${S}${f}`,x=n[o]||n[f];if(!x)return x;return u(x,M(n,o))}function r(n,f,i,c){const o=`${S}${f}`;let x=u(n[o],M(n,o));x=j.get(x)||x;const b=T(i),d=Reflect.set(n,o,b,c);if(d&&B(i,x)&&F)E(n,f,i,x);return d}function g(n,f){return n.hasOwnProperty(`${S}${f}`)||Y(n,f)}function k(n,f){const i=`${S}${f}`,c=D(n,i);let o=u(n[i],M(n,i));o=j.get(o)||o;const x=Reflect.deleteProperty(n,i);if(x&&c)E(n,f,void 0,o);return x}function q(n){if(!n)return null;return new Proxy(n,{get:l,set:r,has:g,deleteProperty:k})}var h=new Map;if(typeof window!=="undefined")window.addEventListener("storage",(n)=>{if(n.key&&n.key.startsWith(S)){let{newValue:f,oldValue:i}=n;if(n.newValue){if(f=u(n.newValue,M(localStorage,n.key)),m(f))f=j.get(f)||f}if(n.oldValue){if(i=u(n.oldValue,M(localStorage,n.key)),m(i))i=j.get(i)||i}E(localStorage,n.key.slice(S.length),f,i)}});var Gn=q(localStorage),Hn=q(sessionStorage);export{t as setPrefix,Hn as session,Gn as local,T as encode,u as decode};
export{Gn as b,Hn as c};
