import{deepEqual as ce}from"fast-equals";import{deepEqual as Q}from"fast-equals";import{memo as Y}from"react";var Z=(m)=>Y(m,(e,f)=>Q(e,f)),d=Z;class l{el;constructor(m){this.el=m}by(m){return this.el=m.call(this,this.el),this}get(){return this.el}}import{deepEqual as $}from"fast-equals";import{useRef as a}from"react";var q=(m)=>(e,f)=>{let t=a(),o=a(0);if(f===void 0||!$(f,t.current))t.current=f,o.current+=1;m(e,[o.current])},H=q;import{useIsomorphicLayoutEffect as B}from"ahooks";import{deepEqual as E}from"fast-equals";import{createContext as c,createElement as F,useContext as k,useReducer as G,useRef as g,useState as L}from"react";import{unstable_batchedUpdates as U}from"react-dom";import{unstable_runWithPriority as w,unstable_NormalPriority as W}from"scheduler";var b=Symbol(),J=Symbol(),A=w?(m)=>w(W,m):(m)=>m();function X(m){return d(({value:f,children:t})=>{let o=g(f),n=g(0),[u,s]=L(null);if(u)u(f),s(null);let M=g();if(!M.current){let r=new Set,p=(y,j)=>{U(()=>{n.current+=1;let T={n:n.current};if(j?.suspense)T.n*=-1,T.p=new Promise((D)=>{s(()=>(S)=>{T.v=S,delete T.p,D(S)})});r.forEach((D)=>D(T)),y()})};M.current={[b]:{v:o,n,l:r,u:p}}}return B(()=>{o.current=f,n.current+=1,A(()=>{M.current[b].l.forEach((r)=>{r({n:n.current,v:f})})})},[f]),F(m,{value:M.current},t)})}function _(m){let e=c({[b]:{v:{current:m},n:{current:-1},l:new Set,u:(f)=>f()}});return e[J]=e.Provider,e.Provider=X(e.Provider),delete e.Consumer,e}function K(m,e){let f=k(m)[b];if(typeof process==="object"){if(!f)throw new Error("useContextSelector requires special context")}let{v:{current:t},n:{current:o},l:n}=f,u=e(t),[s,M]=G((r,p)=>{if(!p)return[t,u];if("p"in p)throw p.p;if(p.n===o){if(E(r[1],u))return r;return[t,u]}try{if("v"in p){if(E(r[0],p.v))return r;let y=e(p.v);if(E(r[1],y))return r;return[p.v,y]}}catch(y){}return[...r]},[t,u]);if(!E(s[1],u))M();return B(()=>{return n.add(M),()=>{n.delete(M)}},[n]),s[1]}function I(m){return K(m,(e)=>e)}function N(m){let e=k(m)[b];if(typeof process==="object"){if(!e)throw new Error("useContextUpdate requires special context")}let{u:f}=e;return f}var x=({context:m,value:e,children:f})=>{let{[J]:t}=m;if(typeof process==="object"){if(!t)throw new Error("BridgeProvider requires special context")}return F(t,{value:e},f)},R=(m)=>{let e=k(m);if(typeof process==="object"){if(!e[b])throw new Error("useBridgeValue requires special context")}return e};import{deepEqual as i}from"fast-equals";import{useRef as P}from"react";var h=(m,e)=>{let f=P();if(!f.current||!i(e,f.current.key))f.current={key:e,value:m()};return f.current.value};import{useMemoizedFn as V}from"ahooks";import{useRef as z}from"react";var O=(m,e=300)=>{let f=z(0),t=z();return V((...o)=>{if(f.current+=1,clearTimeout(t.current),t.current=setTimeout(()=>{f.current=0},e),f.current===2)m(...o),f.current=0})};import{useEventListener as v,useMemoizedFn as ee}from"ahooks";import{useRef as fe,useState as C}from"react";var me=()=>{let[m,e]=C(!1),[f,t]=C(),o=fe(null);v("mouseup",()=>{let u=window.getSelection();if(!u)return;if(!u.toString().length)return;let M=u.getRangeAt(0),r=M.commonAncestorContainer,p=!1,y=r;while(y){if(y.hasAttribute("contenteditable")&&y.getAttribute("contenteditable")){p=!0;break}if(y.parentNode)y=y.parentNode;else break}if(!p)return;e(!0),t(M.getBoundingClientRect())},{target:o});let n=ee(()=>e(!1));return{selection_container:o,markup_visible:m,markup_rect:f,closeMarkup:n}};import{useUpdateEffect as te}from"ahooks";var re=H(te);export{me as useSelection,O as useDoubleClick,re as useDeepUpdateEffect,h as useDeepMemo,N as useContextUpdate,K as useContextSelector,I as useContext,R as useBridgeValue,d as memo,l as handle,ce as deepEqual,H as createDeepCompareEffect,_ as createContext,x as BridgeProvider};
